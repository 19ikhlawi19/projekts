# Kotlin/Gradle: SchimmenSpiel, CableCar
# Läuft nur, wenn Dateien unter SchimmenSpiel/ oder CableCar/ geändert wurden.

name: CI Kotlin (Gradle)

on:
  push:
    branches: [main, master]
    paths:
      - 'SchimmenSpiel/**'
      - 'CableCar/**'
      - '.github/workflows/ci-kotlin.yml'
  pull_request:
    branches: [main, master]
    paths:
      - 'SchimmenSpiel/**'
      - 'CableCar/**'
      - '.github/workflows/ci-kotlin.yml'

jobs:
  schimmenspiel:
    name: SchimmenSpiel
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Fix gradlew line endings (CRLF → LF)
        run: sed -i 's/\r$//' SchimmenSpiel/gradlew

      - name: Grant execute permission for gradlew
        run: chmod +x SchimmenSpiel/gradlew

      - name: Build
        run: cd SchimmenSpiel && ./gradlew build --no-daemon

  cablecar:
    name: CableCar
    runs-on: ubuntu-latest
    # Nur ausführen, wenn Secret gesetzt ist (CableCar braucht SoPra-Maven für ntf)
    if: ${{ secrets.SOPRA_GITLAB_TOKEN != '' }}
    env:
      SOPRA_GITLAB_TOKEN: ${{ secrets.SOPRA_GITLAB_TOKEN }}
    steps:
      - uses: actions/checkout@v4

      - name: Set up JDK 11
        uses: actions/setup-java@v4
        with:
          java-version: '11'
          distribution: 'temurin'
          cache: 'gradle'

      - name: Fix gradlew line endings (CRLF → LF)
        run: sed -i 's/\r$//' CableCar/gradlew

      - name: Grant execute permission for gradlew
        run: chmod +x CableCar/gradlew

      - name: Build
        run: cd CableCar && ./gradlew build --no-daemon
